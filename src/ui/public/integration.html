<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>podcli — Integration</title>
  <link rel="icon" type="image/png" href="/podcli-icon-transparent.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,400;0,500;0,600;0,700;1,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
  <style>
    .app { max-width: 780px; }
    .header { margin-bottom: 40px; }
  </style>
</head>
<body>
  <div class="app fade-in">

    <!-- Nav -->
    <div class="nav">
      <a href="/"><img src="/podcli-logo-transparent.png" alt="podcli" style="height:22px"></a>
      <a href="/" class="nav-link">Back to app</a>
    </div>

    <!-- Header -->
    <div class="header">
      <h1>MCP Integration</h1>
      <p class="subtitle">Connect podcli to Claude Desktop, Claude Code, or any MCP-compatible client to generate clips through conversation.</p>
    </div>

    <!-- Connection Status -->
    <div id="status-bar" class="status-bar warn">
      <div class="status-dot"></div>
      <span id="status-text">Checking connection...</span>
    </div>

    <!-- Setup: Claude Desktop -->
    <div class="card">
      <div class="card-label">Setup</div>
      <div class="card-title">Claude Desktop</div>
      <div class="card-desc">
        Add podcli as an MCP server in your Claude Desktop configuration file. Claude will gain access to transcription, clip suggestion, and rendering tools.
      </div>

      <div class="steps">
        <div class="step">
          <div class="step-title">Open your config file</div>
          <div class="step-desc">
            macOS: <code>~/Library/Application Support/Claude/claude_desktop_config.json</code><br>
            Windows: <code>%APPDATA%\Claude\claude_desktop_config.json</code>
          </div>
        </div>
        <div class="step">
          <div class="step-title">Add the podcli server entry</div>
          <div class="step-desc">Paste this into the <code>mcpServers</code> object:</div>
        </div>
      </div>

      <div class="code-block" style="margin-bottom:16px">
        <div class="code-header">
          <span class="code-filename">claude_desktop_config.json</span>
          <button class="copy-btn" onclick="copyBlock(this, 'desktop-config')">Copy</button>
        </div>
        <pre id="desktop-config"><span class="punct">{</span>
  <span class="key">"mcpServers"</span><span class="punct">:</span> <span class="punct">{</span>
    <span class="key">"podcli"</span><span class="punct">:</span> <span class="punct">{</span>
      <span class="key">"command"</span><span class="punct">:</span> <span class="str">"node"</span><span class="punct">,</span>
      <span class="key">"args"</span><span class="punct">:</span> <span class="punct">[</span><span class="str" id="desktop-dist-path">"<span class="comment">loading...</span>"</span><span class="punct">]</span>
    <span class="punct">}</span>
  <span class="punct">}</span>
<span class="punct">}</span></pre>
      </div>

      <div class="step" style="padding-left:40px; counter-increment: step;">
        <div class="step-title">Restart Claude Desktop</div>
        <div class="step-desc">After saving, restart the app. You should see podcli listed in the MCP tools panel.</div>
      </div>
    </div>

    <!-- Setup: Claude Code -->
    <div class="card">
      <div class="card-title">Claude Code (CLI)</div>
      <div class="card-desc">
        Add podcli as an MCP server in your Claude Code project or global settings.
      </div>

      <div class="steps">
        <div class="step">
          <div class="step-title">Run this command in your terminal</div>
          <div class="step-desc">This registers podcli as an MCP server for the current project scope:</div>
        </div>
      </div>

      <div class="code-block">
        <div class="code-header">
          <span class="code-filename">terminal</span>
          <button class="copy-btn" onclick="copyBlock(this, 'code-config')">Copy</button>
        </div>
        <pre id="code-config"><span id="code-cmd-text"><span class="comment"># loading path...</span></span></pre>
      </div>
    </div>

    <div class="divider"></div>

    <!-- Available Tools -->
    <div class="card">
      <div class="card-label">Reference</div>
      <div class="card-title">Available MCP Tools</div>
      <div class="card-desc">These tools become available to Claude after connecting.</div>

      <div class="tool-grid">
        <div class="tool-item">
          <span class="tool-name">transcribe_podcast</span>
          <span class="tool-desc">Transcribe audio/video with Whisper. Supports model size selection, language detection, and speaker diarization.</span>
        </div>
        <div class="tool-item">
          <span class="tool-name">suggest_clips</span>
          <span class="tool-desc">Submit an array of viral moment suggestions with title, time range, and reasoning. Used by Claude to pass clip ideas.</span>
        </div>
        <div class="tool-item">
          <span class="tool-name">create_clip</span>
          <span class="tool-desc">Render a single short-form clip with caption style, crop strategy, and optional logo overlay.</span>
        </div>
        <div class="tool-item">
          <span class="tool-name">batch_create_clips</span>
          <span class="tool-desc">Render multiple clips in one call. Each clip can have its own caption style and crop settings.</span>
        </div>
      </div>
    </div>

    <!-- Example Prompts -->
    <div class="card">
      <div class="card-title">Example Prompts</div>
      <div class="card-desc">Try these with Claude after connecting:</div>

      <div class="tool-grid">
        <div class="tool-item" style="cursor:default;">
          <span class="tool-desc" style="color:var(--text);"><em>"Transcribe /path/to/episode.mp4 and find the 5 most viral moments, then export them with hormozi captions"</em></span>
        </div>
        <div class="tool-item" style="cursor:default;">
          <span class="tool-desc" style="color:var(--text);"><em>"Create a 30-second clip from 12:45 to 13:15 with branded captions and face-tracking crop"</em></span>
        </div>
        <div class="tool-item" style="cursor:default;">
          <span class="tool-desc" style="color:var(--text);"><em>"Batch export all suggested clips with karaoke-style captions"</em></span>
        </div>
      </div>
    </div>

  </div>

  <script>
    // Resolve the dist path and populate config blocks
    async function init() {
      try {
        const resp = await fetch('/api/integration-info');
        const data = await resp.json();

        // Desktop config
        const distEl = document.getElementById('desktop-dist-path');
        if (distEl) distEl.textContent = `"${data.dist_path}"`;

        // Claude Code command
        const codeEl = document.getElementById('code-cmd-text');
        if (codeEl) {
          codeEl.innerHTML = `claude mcp add podcli node ${escapeHtml(data.dist_path)}`;
        }

        // Status
        const bar = document.getElementById('status-bar');
        const txt = document.getElementById('status-text');
        if (data.server_ok) {
          bar.className = 'status-bar ok';
          txt.textContent = `Server running — ${data.tools_count} tools available`;
        } else {
          bar.className = 'status-bar err';
          txt.textContent = 'Server not built. Run: npm run build';
        }
      } catch (e) {
        const bar = document.getElementById('status-bar');
        const txt = document.getElementById('status-text');
        bar.className = 'status-bar err';
        txt.textContent = 'Could not reach server';
      }
    }

    function escapeHtml(str) {
      return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    }

    function copyBlock(btn, id) {
      const el = document.getElementById(id);
      const text = el.innerText;
      navigator.clipboard.writeText(text).then(() => {
        btn.textContent = 'Copied';
        btn.classList.add('copied');
        setTimeout(() => { btn.textContent = 'Copy'; btn.classList.remove('copied'); }, 1500);
      });
    }

    init();
  </script>
</body>
</html>
